window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ){return {staticAssetsBase:"\u002F_nuxt\u002Fstatic\u002F1615939340",layout:Z,error:aI,serverRendered:true,routePath:aJ,config:{app:{basePath:"\u002F",assetsPath:"\u002F_nuxt\u002F",cdnURL:aI},content:{dbHash:"f5a6448a"}},ssrRefs:{"DLpc459RN0pgflNjP7D+YQ==":{slug:"next-apollo-express",description:"How to fit Next.js with Apollo Client on front end and Apollo Server GraphQL api into a single Express app.",title:aK,keywords:["NextJS","Apollo",aL,aM],toc:[{id:aN,depth:K,text:aO},{id:aP,depth:K,text:aQ},{id:aR,depth:K,text:aS},{id:aT,depth:K,text:aU},{id:aV,depth:K,text:aW},{id:aX,depth:K,text:aY},{id:aZ,depth:K,text:a_},{id:a$,depth:K,text:ba},{id:bb,depth:K,text:bc},{id:bd,depth:K,text:be},{id:bf,depth:K,text:bg}],body:{type:"root",children:[{type:b,tag:ao,props:{id:"nextjs-apollo-client-and-server-on-a-single-express-app"},children:[{type:b,tag:s,props:{href:"#nextjs-apollo-client-and-server-on-a-single-express-app",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aK}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"This article describes two things:"}]},{type:a,value:f},{type:b,tag:bh,props:{},children:[{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"How to fit "},{type:b,tag:h,props:{},children:[{type:a,value:"Next.js"}]},{type:a,value:bi},{type:b,tag:h,props:{},children:[{type:a,value:bj}]},{type:a,value:" on front end and "},{type:b,tag:h,props:{},children:[{type:a,value:"Apollo Server"}]},{type:a,value:g},{type:b,tag:h,props:{},children:[{type:a,value:aL}]},{type:a,value:" api into a single "},{type:b,tag:h,props:{},children:[{type:a,value:aM}]},{type:a,value:" app. Another important requirement was to have "},{type:b,tag:h,props:{},children:[{type:a,value:ab}]},{type:a,value:" support. As there is not much info about it out there, this is the main purpose of this guide."}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"How to organize everything nicely into "},{type:b,tag:h,props:{},children:[{type:a,value:bk}]},{type:a,value:g},{type:b,tag:h,props:{},children:[{type:a,value:ac}]},{type:a,value:" and deploy to "},{type:b,tag:h,props:{},children:[{type:a,value:"Heroku"}]},{type:a,value:" as a single free plan app. You will find a lot of into about it, but I included it here as a part of the process of the project I was working on."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Usually you might not want to put everything together, moreover host on the same server. But I needed the whole stack quick and in the same repo for the showcase. I also wanted to use "},{type:b,tag:h,props:{},children:[{type:a,value:"TypeScript"}]},{type:a,value:" as a bonus."}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aN},children:[{type:b,tag:s,props:{href:"#acceptance-criteria",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aO}]},{type:a,value:f},{type:b,tag:bl,props:{},children:[{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"Next.js React frontend"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"GraphQL api"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"single entry point\u002Fhost\u002Fserver"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"single repository"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"yet decoupled packages: client, api, server ... later other services"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"SSR support"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"TypeScript everywhere"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"hot reload everything"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"deployed on heroku"}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"should take no more than 1 hour to get up and running beta"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aP},children:[{type:b,tag:s,props:{href:"#tldr",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aQ}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Source code "},{type:b,tag:s,props:{href:"https:\u002F\u002Fgithub.com\u002Fgivehug\u002Fdevto-monorepo",rel:[ap,aq,ar],target:as},children:[{type:a,value:"here"}]}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aR},children:[{type:b,tag:s,props:{href:"#steps",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aS}]},{type:a,value:f},{type:b,tag:bh,props:{},children:[{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#design"},children:[{type:a,value:bm}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#monorepo"},children:[{type:a,value:ac}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#graphql"},children:[{type:a,value:"graphql api"}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#client"},children:[{type:a,value:"client app"}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#server"},children:[{type:a,value:bn}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#dev"},children:[{type:a,value:"connecting everything together"}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#heroku"},children:[{type:a,value:"setting up heroku"}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:b,tag:s,props:{href:"#deploy"},children:[{type:a,value:"deploying"}]}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aT},children:[{type:b,tag:s,props:{href:"#1-design-a-namedesigna",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aU},{type:b,tag:s,props:{name:bm},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Here is how you would usually want to use graphql - as a API Gateway between client app and back end services:"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"information flow",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Finfo-flow.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We are doing the same thing basically, but our server routing will look like:"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"network routing",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Frouting.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"And here is the dependency diagram of our main packages:"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"monorepo packages",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fpackages.png"},children:[]}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aV},children:[{type:b,tag:s,props:{href:"#2-setting-up-the-monorepo-a-namemonorepoa",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aW},{type:b,tag:s,props:{name:ac},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We want every service in a single repo, but at the same time decoupled - "},{type:b,tag:h,props:{},children:[{type:a,value:ac}]},{type:a,value:". We can do it seamlessly with the help of "},{type:b,tag:h,props:{},children:[{type:a,value:bk}]},{type:a,value:w}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Folder structure:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,_]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"root\n |- packages\n |   |- client\n |   |- graphql\n |   |- server\n |- package.json\n |- yarn.lock\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"package.json"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,ad]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"monorepo\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n ...\n  "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"yarn workspace @monorepo\u002Fclient run build\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"yarn workspace @monorepo\u002Fserver run start\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"export $(cat .env | xargs) && yarn workspace @monorepo\u002Fserver run dev\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"private\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bp]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"workspaces\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"["}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"packages\u002F*\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"]"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"engines\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"node\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"13.x\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"No dependencies here. "},{type:b,tag:h,props:{},children:[{type:a,value:"private\": true"}]},{type:a,value:" is required by yarn workspaces. "},{type:b,tag:h,props:{},children:[{type:a,value:"\"workspaces\": [...]"}]},{type:a,value:" declares where our packages live. Each script executes yarn command in specified workspace. In "},{type:b,tag:h,props:{},children:[{type:a,value:bq}]},{type:a,value:" script we read local development environment variables from "},{type:b,tag:h,props:{},children:[{type:a,value:br}]},{type:a,value:" file before starting dev server. (If it does not work on your OS, replace with what works for you)"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:br}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,_]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"NODE_ENV=development\nPORT=3000\nGRAPHQL_URI=http:\u002F\u002Flocalhost:3000\u002Fgraphql\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Let's agree on the naming convention for our packages: "},{type:b,tag:h,props:{},children:[{type:a,value:"@monorepo\u002Fpackage-name"}]},{type:a,value:w}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aX},children:[{type:b,tag:s,props:{href:"#3-setting-up-graphql-api-a-namegraphqla",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:aY},{type:b,tag:s,props:{name:af},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"This one is the easiest."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fgraphql\u002Fpackage.json"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,ad]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"@monorepo\u002Fgraphql\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"apollo-server-express\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"2.12.0\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fgraphql\u002Findex.ts"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,$]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" ApolloServer"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" gql "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'apollo-server-express'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:" typeDefs "},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,ay]},children:[{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,af,bt]},children:[{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"type"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"Query"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,bu]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:a,value:" String\n  "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]},{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n  Query"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,bw,v]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:ag}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'Hello world!'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:" server "},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"ApolloServer"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" typeDefs"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:bv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ai}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:Z}]},{type:a,value:" server\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Everything super simple: schema, reducer. At the end we create Apollo Server, export it, but do not start it right away."}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:aZ},children:[{type:b,tag:s,props:{href:"#4-setting-up-the-client-app-a-nameclienta",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:a_},{type:b,tag:s,props:{name:bx},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"This one is trickier. We need to make Next js use Apollo Client for fetching the data and make sure SSR is supported."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"To bootstrap the Next.js app, I followed this "},{type:b,tag:s,props:{href:"https:\u002F\u002Fnextjs.org\u002Flearn\u002Fbasics\u002Fgetting-started\u002Fsetup",rel:[ap,aq,ar],target:as},children:[{type:a,value:"quick start guide"}]},{type:a,value:".js app. But we'll need certain modifications."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fclient\u002Fpackage.json"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,ad]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"@monorepo\u002Fclient\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"next\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"next build\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"next start\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    ...\n  "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Nothing special."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Now, to set up "},{type:b,tag:h,props:{},children:[{type:a,value:bj}]},{type:a,value:bi},{type:b,tag:h,props:{},children:[{type:a,value:ab}]},{type:a,value:", lets copy "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002FapolloClient.js"}]},{type:a,value:by},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Flib\u002Fapollo.js"}]},{type:a,value:" from "},{type:b,tag:s,props:{href:"https:\u002F\u002Fgithub.com\u002Fzeit\u002Fnext.js\u002Ftree\u002Fcanary\u002Fexamples\u002Fwith-apollo",rel:[ap,aq,ar],target:as},children:[{type:a,value:"next.js\u002Fexamples\u002Fwith-apollo"}]},{type:a,value:w}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We need to modify "},{type:b,tag:h,props:{},children:[{type:a,value:"apolloClient.js"}]},{type:a,value:" slightly:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,bz]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,"spread",k]},children:[{type:a,value:"..."}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ai}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:Z}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:v}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"createApolloClient"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,"parameter"]},children:[{type:a,value:bA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" ctx"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aj}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"ApolloClient"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    ssrMode"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,"known-class-name",T]},children:[{type:a,value:"Boolean"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"ctx"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n    link"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"HttpLink"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n      uri"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:bB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:al}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,"comment"]},children:[{type:a,value:"\u002F\u002F must be absolute for SSR to work"}]},{type:a,value:"\n      credentials"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'same-origin'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n      fetch"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n    cache"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ah}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:"InMemoryCache"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,"method",v,ak]},children:[{type:a,value:"restore"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:";"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We'll point link.url to either our local dev server or to heroku host based on "},{type:b,tag:h,props:{},children:[{type:a,value:al}]},{type:a,value:" environment variable. The url is "},{type:b,tag:h,props:{},children:[{type:a,value:bC}]},{type:a,value:" by default, but for SSR to work we have to put absolute path there. Don't ask me why."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We'll have two pages, one with SSR and another without it."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fclient\u002Fpages\u002Findex.ts"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,bz]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,aa]},children:[{type:b,tag:c,props:{className:[d,bD]},children:[{type:a,value:"React"}]}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'react'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,aa]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" useQuery "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'@apollo\u002Freact-hooks'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,aa]},children:[{type:b,tag:c,props:{className:[d,bD]},children:[{type:a,value:aB}]}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'..\u002Fcomponents\u002FLayout'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,aa]},children:[{type:a,value:"gql"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'graphql-tag'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,aa]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" withApollo "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'..\u002Fapollo\u002Fapollo'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bE}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,ay]},children:[{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,af,bt]},children:[{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"query"}]},{type:a,value:" GetHello "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n    hello\n  "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]},{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bw,v]},children:[{type:a,value:bF}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bG,k]},children:[{type:a,value:ag}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" data"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" loading"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" error"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:" refetch "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aD}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"loading"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aj}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Loading..."}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aD}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aj}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Error: "}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:"message"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aj}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:aB}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"This should be rendered on client side"}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:A}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Data: "}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"data"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:A}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:X}]},{type:a,value:bJ}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bu]},children:[{type:a,value:"onClick"}]},{type:b,tag:c,props:{className:[d,"script","language-javascript"]},children:[{type:b,tag:c,props:{className:[d,"script-punctuation",e]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bG,k]},children:[{type:a,value:ag}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Refetch"}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:a,value:bJ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,x]},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,T]},children:[{type:a,value:aB}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:J}]}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ai}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:Z}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"withApollo"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" ssr"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bp]},children:[{type:a,value:"false"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:bF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Notice how concise "},{type:b,tag:h,props:{},children:[{type:a,value:bH}]},{type:a,value:" hook is. Beauty. At the bottom we just wrap our page into "},{type:b,tag:h,props:{},children:[{type:a,value:"withApollo({ ssr: false })(NOSSR)"}]},{type:a,value:" to enable\u002Fdisable the SSR. We'll have another almost identical page, "},{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fclient\u002Fpages\u002Fssr.ts"}]},{type:a,value:" but with "},{type:b,tag:h,props:{},children:[{type:a,value:"ssr: true"}]},{type:a,value:w}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Finally, "},{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fclient\u002Findex.ts"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,$]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:" next "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'next'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"next"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n  dev"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:"NODE_ENV"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:"!=="}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'production'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n  dir"},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:" __dirname"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ai}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:Z}]},{type:a,value:" nextApp\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We are creating Next.js app and exporting it to later be used in express."}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:a$},children:[{type:b,tag:s,props:{href:"#5-configuring-express-server-a-nameservera",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:ba},{type:b,tag:s,props:{name:bn},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Alright, its time to stitch everything together."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fserver\u002Fpackage.json"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,ad]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"@monorepo\u002Fserver\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"ts-node index.ts\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"nodemon index.ts\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"express\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"4.17.1\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"ts-node\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"8.8.2\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"typescript\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"3.8.3\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"devDependencies\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"nodemon\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"2.0.3\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"\"@types\u002Fnode\""}]},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"\"13.11.1\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"We'll use "},{type:b,tag:h,props:{},children:[{type:a,value:"ts-node"}]},{type:a,value:" to run our TypeScript app on production, it will compile it and keep the build in cache. We'll use "},{type:b,tag:h,props:{},children:[{type:a,value:"nodemon"}]},{type:a,value:" for the hot reload. Latest versions have built in TypeScript support, no need to do anything other than "},{type:b,tag:h,props:{},children:[{type:a,value:"nodemon index.ts"}]},{type:a,value:". Magic!"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"And the epxress server itself "},{type:b,tag:h,props:{},children:[{type:a,value:"packages\u002Fserver\u002Findex.ts"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,$]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:" express "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'express'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:bL},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'@monorepo\u002Fclient'"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:N}]},{type:a,value:" apolloServer "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:O}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"'@monorepo\u002Fgraphql'"}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:aF}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:a,value:"env\n\n"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:v}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:a,value:" app "},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:P}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"express"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:"\n\n  app"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"listen"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:ag}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aD}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"throw"}]},{type:a,value:" err\n    "},{type:b,tag:c,props:{className:[d,"builtin"]},children:[{type:a,value:"console"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"log"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,ay]},children:[{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:"[ server ] ready on port "}]},{type:b,tag:c,props:{className:[d,"interpolation"]},children:[{type:b,tag:c,props:{className:[d,bR,e]},children:[{type:a,value:"${"}]},{type:b,tag:c,props:{className:[d,U]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,bR,e]},children:[{type:a,value:n}]}]},{type:b,tag:c,props:{className:[d,V,m]},children:[{type:a,value:W}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:v}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bP}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:"\n  expressApp"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:bV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:v}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n  apolloServer"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:bY},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bM}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Notice how we import "},{type:b,tag:h,props:{},children:[{type:a,value:bx}]},{type:a,value:by},{type:b,tag:h,props:{},children:[{type:a,value:af}]},{type:a,value:" packages. That's possible thanks to yarn workspaces simlinking."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Next.js and Apollo Server have different express APIs. Next creates request handler that can be used as express middleware:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,$]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:am}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:"\nexpressApp"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,m]},children:[{type:a,value:bV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Apollo Server does the same thing, but inside "},{type:b,tag:h,props:{},children:[{type:a,value:aH}]},{type:a,value:" method:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,$]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"apolloServer"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:w}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,k]},children:[{type:a,value:l}]},{type:a,value:bY},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:bb},children:[{type:b,tag:s,props:{href:"#6-running-dev-server-a-namedeva",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:bc},{type:b,tag:s,props:{name:bq},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Now that we have all the source code ready, from root run:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,_]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"yarn install\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"This will instal all the dependencies and do the simlinking between our packages. If you inspect the content of root "},{type:b,tag:h,props:{},children:[{type:a,value:"node_modules"}]},{type:a,value:" in eg VS Code editor, you'll notice something like this:"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"yarn workspaces simlinking",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fsimlinks.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"It looks like our monorepo packages were added to the root node_modules, but the arrow icons indicate that those are just simlinks pointing to the corresponding place in the file system. Very nice!"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Now, go ahead and run from root:"}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,_]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"yarn dev\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"dev server stdout",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fstdout.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"And open the app at "},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Flocalhost:3000"}]},{type:a,value:w}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"network devtools",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fnetwork.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"From the network logs you can see that there was an XHR request to "},{type:b,tag:h,props:{},children:[{type:a,value:bC}]},{type:a,value:" after page was rendered. If you click "},{type:b,tag:h,props:{},children:[{type:a,value:bK}]},{type:a,value:" or go to the "},{type:b,tag:h,props:{},children:[{type:a,value:ab}]},{type:a,value:" page with the link, no extra request will be sent. That's because the data is already present in Apollo Client cache and wont be refetched without explicit instructions. Magic again!"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Now, if we reload the "},{type:b,tag:h,props:{},children:[{type:a,value:ab}]},{type:a,value:" page, we will notice that there is no XHR request after page is rendered, and if we inspect the page source, we'll see that "},{type:b,tag:h,props:{},children:[{type:a,value:"Data: Hello world!"}]},{type:a,value:" text is already there. SSR works as expected."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Lastly, navigate to "},{type:b,tag:h,props:{},children:[{type:a,value:"http:\u002F\u002Flocalhost:3000\u002Fgraphql"}]},{type:a,value:". When in dev mode, you should see the Apollo grapqhl playground screen:"}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"graphql playground",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fdev-gql.png"},children:[]}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:bd},children:[{type:b,tag:s,props:{href:"#7-setting-up-heroku-app-a-nameherokua",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:be},{type:b,tag:s,props:{name:"heroku"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"I wont describe much about the process of setting up new account and creating the app, but its pretty straight forward and should not take longer than 5 minutes."}]},{type:a,value:f},{type:b,tag:bl,props:{},children:[{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"Go to "},{type:b,tag:h,props:{},children:[{type:a,value:"https:\u002F\u002Fwww.heroku.com\u002F"}]},{type:a,value:", crete a free plan account."}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"Do to your dashboard "},{type:b,tag:h,props:{},children:[{type:a,value:"https:\u002F\u002Fdashboard.heroku.com\u002Fapps"}]}]},{type:a,value:f},{type:b,tag:y,props:{},children:[{type:a,value:"Click "},{type:b,tag:h,props:{},children:[{type:a,value:"New"}]},{type:a,value:" -\u003E "},{type:b,tag:h,props:{},children:[{type:a,value:"Create new app"}]},{type:a,value:", choose app name, region, and click "},{type:b,tag:h,props:{},children:[{type:a,value:"Create app"}]},{type:a,value:w}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"You will land on the page with instructions of how to "},{type:b,tag:h,props:{},children:[{type:a,value:"install heroku cli"}]},{type:a,value:" and deploy your app."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"One more thing you have to do is to set up "},{type:b,tag:h,props:{},children:[{type:a,value:al}]},{type:a,value:" env var. Go to "},{type:b,tag:h,props:{},children:[{type:a,value:"Settings"}]},{type:a,value:" tab in heroku dashboard. In "},{type:b,tag:h,props:{},children:[{type:a,value:"Domains"}]},{type:a,value:" section you will find text "},{type:b,tag:h,props:{},children:[{type:a,value:"Your app can be found at https:\u002F\u002Fyour-app-name.herokuapp.com\u002F"}]},{type:a,value:". Copy that url, scroll up to the "},{type:b,tag:h,props:{},children:[{type:a,value:"Config Vars"}]},{type:a,value:" section and create new env var with key "},{type:b,tag:h,props:{},children:[{type:a,value:al}]},{type:a,value:" and value "},{type:b,tag:h,props:{},children:[{type:a,value:"https:\u002F\u002Fyour-app-name.herokuapp.com\u002Fgraphql"}]},{type:a,value:l}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"heroku env vars",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fenvvars1.png"},children:[]}]},{type:a,value:f},{type:b,tag:L,props:{},children:[]},{type:a,value:f},{type:b,tag:M,props:{id:bf},children:[{type:b,tag:s,props:{href:"#8-deploying-a-namedeploya",ariaHidden:F,tabIndex:G},children:[{type:b,tag:c,props:{className:[H,I]},children:[]}]},{type:a,value:bg},{type:b,tag:s,props:{name:"deploy"},children:[]}]},{type:a,value:f},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:A,props:{className:[D,_]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"heroku login\ngit init\ngit add .\ngit commit -am \"make it better\"\ngit push heroku master\n"}]}]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"This will initiate the deployment process. Now here is the last Magical part. Heroku will recognize that your app is NodeJS based, you don't have to configure anything yourself. Moreover, Heroku will figure out that you use "},{type:b,tag:h,props:{},children:[{type:a,value:"yarn"}]},{type:a,value:" as a package manager and will run "},{type:b,tag:h,props:{},children:[{type:a,value:"yarn install"}]},{type:a,value:" after it fetches the source files. Then it will investigate your root package.json, find "},{type:b,tag:h,props:{},children:[{type:a,value:"build"}]},{type:a,value:" script and run it. Finally it will look for the "},{type:b,tag:h,props:{},children:[{type:a,value:"start"}]},{type:a,value:" script and use it to start the app by default. Awesome. All the set up literally take about 15 minutes if you don't have an existing account."}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:b,tag:Q,props:{alt:"heroku deployment",src:"https:\u002F\u002Fraw.githubusercontent.com\u002Fgivehug\u002Fdevto-monorepo\u002Fmaster\u002Fdocs\u002Fimg\u002Fdeploy1.png"},children:[]}]},{type:a,value:f},{type:b,tag:j,props:{},children:[{type:a,value:"Alright, navigate to your heroku app url, and we all set."}]}]},dir:"\u002Farticles",path:aJ,extension:".md",createdAt:bZ,updatedAt:bZ}}}}("text","element","span","token","punctuation","\n"," ","code","keyword","p","operator",":","string","}","{",",","(",")","a","property","\n  ","function",".","tag","li","\n    ","pre","div","nuxt-content-highlight","line-numbers","\n\n","true",-1,"icon","icon-link","\u003E",2,"hr","h2","import","from","=","img","const","plain-text","class-name","constant","template-punctuation","`","\u003C","\u003C\u002F","default","language-text","language-ts","imports","SSR","monorepo","language-json","\"name\"","graphql","=\u003E","new","export","return","property-access","GRAPHQL_URI","await"," nextApp","h1","nofollow","noopener","noreferrer","_blank","\"scripts\"","\"start\"","\"dev\"","\n  ...\n  ","\"dependencies\"","template-string","hello"," process","Layout","\n\n  ","if","\n      ","PORT","async","applyMiddleware",null,"\u002Farticles\u002Fnext-apollo-express","Next.js, Apollo Client and Server on a single Express app","GraphQL","Express","acceptance-criteria","Acceptance criteria","tldr","TLDR","steps","Steps","1-design-a-namedesigna","1. Design ","2-setting-up-the-monorepo-a-namemonorepoa","2. Setting up the Monorepo ","3-setting-up-graphql-api-a-namegraphqla","3. Setting up GraphQL API ","4-setting-up-the-client-app-a-nameclienta","4. Setting up the Client App ","5-configuring-express-server-a-nameservera","5. Configuring express server ","6-running-dev-server-a-namedeva","6. Running dev server ","7-setting-up-heroku-app-a-nameherokua","7. Setting up heroku app ","8-deploying-a-namedeploya","8. Deploying ","ol"," with ","Apollo Client","yarn workspaces","ul","design","server","\"build\"","boolean","dev",".env"," gql","language-graphql","attr-name"," resolvers ","function-variable","client"," and ","language-tsx","initialState","env","\u002Fgraphql","maybe-class-name","QUERY","NOSSR","arrow","useQuery","error","button","refetch"," nextApp ","main","bootstrapApolloServer","app","bootstrapClientApp","err","interpolation-punctuation","expressApp","prepare","get","'*'","getRequestHandler"," app"," expressApp ","2021-03-17T00:01:40.816Z"));